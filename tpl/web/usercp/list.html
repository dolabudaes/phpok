<!-- include tpl=usercp/head title=$page_rs.title -->
<script type="text/javascript">
function post_del(id)
{
	$.dialog.confirm('确定要删除 #'+id+' 的{$page_rs.alias_title ? $page_rs.alias_title : "主题"}吗？删除后是不能恢复的！',function(){
		var url = api_url('post','del','id='+id);
		$.phpok.json(url,function(rs){
			if(!rs.status){
				$.dialog.alert(rs.info);
				return false;
			}
			$.dialog.tips('删除成功');
			$("#list_"+id).remove();
			return false;
		});
	});
}
</script>
<div class="layui-card">
	<div class="layui-card-header">
		{$page_rs.title}
		<!-- if $page_rs.post_status && $popedom.add -->
		<div class="float-right">
			<input type="button" value="添加" onclick="$.win('{$page_rs.title}_添加','{url ctrl=post id=$page_rs.identifier/}')" class="layui-btn layui-btn-sm" />
		</div>
		<!-- /if -->
	</div>
	<div class="layui-card-body">
		<table id="tablelist" lay-filter="tablelist" data-psize="{$psize}" data-total="{$total}" data-ftype="{$m_rs.id}" data-totalRow="{$page_rs.admin-list-stat}">
		<thead>
		<tr>
			<th lay-data="{field:'id', width:70,fixed:'left',sort:true,align:'center'}">ID</th>
			<th lay-data="{field:'status', width:60,fixed:'left',unresize:true}">状态</th>
			<th lay-data="{field:'title',minWidth:180,fixed:'left',sort:true}">{$page_rs.alias_title ? $page_rs.alias_title : P_Lang('主题')}</th>
			<!-- if $page_rs.is_biz -->
			<th lay-data="{field:'price', minWidth:90,sort:true,align:'left'}">{lang价格}</th>
			<!-- /if -->
			<!-- if $page_rs.cate -->
			<th lay-data="{field:'cate_id', width:100,align:'center'}">{lang分类}</th>
			<!-- /if -->
			<!-- loop from=$layout key=$key value=$value -->
			<th lay-data="{field:'{$key}', width:{$value.width},edit:false,sort:{$value.sort},align:'{$value.align}'}">{$value.title}</th>
			<!-- /loop -->
			<!-- if $page_rs.is_front || $popedom.edit || $popedom.delete -->
			<th lay-data="{field:'_action', width:135,align:'left',fixed:'right',unresize:true}">{lang操作}</th>
			<!-- /if -->
		</tr>
		</thead>
		<!-- loop from=$rslist key=$key value=$value id=$tmpid -->
		<tr id="list_{$value.id}">
			<td>{$value.id}</td>
			<td><!-- if $value.status -->正常<!-- else --><span class="red">审核</span><!-- /if --></td>
			<td>{$value.title}</td>
			<!-- if $page_rs.is_biz -->
			<td><!-- if $value.price -->{func price_format $value.price $value.currency_id}<!-- /if --></td>
			<!-- /if -->
			<!-- if $page_rs.cate -->
			<td>{$value.cate.title}</td>
			<!-- /if -->
			<!-- loop from=$layout key=$k value=$v id=$idx -->
				<!-- if $k == "dateline" -->
				<td class="center">{func date "Y-m-d H:i" $value.dateline}</td>
				<!-- elseif $k == "hits" -->
				<td class="center">{$value.hits}</td>
				<!-- elseif $k == 'sort' -->
				<td class="center">{$value.sort}</td>
				<!-- elseif $k == "user_id" -->
				<td>{$value._user ? $value._user : '-'}</td>
				<!-- else -->
				<td>
					<!-- if is_array($value[$k]) && $value[$k]['type'] -->
						<!-- if $value[$k]['title'] && is_array($value[$k]['title']) -->
						{echo implode(' / ',$value[$k]['title'])}			
						<!-- else -->
						{$value[$k]['title']}
						<!-- /if -->
					<!-- else -->
						<!-- if is_array($value[$k]) && $value[$k][0] -->
						<!-- loop from=$value[$k] key=$kk value=$vv id=$idxx -->
						{$vv._show}
						<!-- /loop -->
						<!-- elseif is_array($value[$k]) && $value[$k]['_show'] -->
						{$value[$k]['_show']}
						<!-- else -->
						{$value[$k] ? $value[$k] : '-'}
						<!-- /if -->
					<!-- /if -->
				</td>			
				<!-- /if -->
			<!-- /loop -->
			<!-- if $page_rs.is_front || $popedom.edit || $popedom.delete -->
			<td>
				<div class="layui-btn-group" name="list-content-btns" id="btn_{$value.id}" data-id="{$value.id}">
					<!-- if $page_rs.is_front -->
					<input type="button" value="{lang查看}" onclick="$.phpok.open('{url id=$value.id/}')" class="layui-btn layui-btn-xs layui-btn-normal" />
					<!-- /if -->
					<!-- if $popedom.edit -->
					<input type="button" value="{lang编辑}" onclick="$.win('{lang编辑主题}_#{$value.id}','{url ctrl=post func=edit id=$value.id/}')" class="layui-btn layui-btn-xs" />
					<!-- /if -->
					<!-- if $popedom.delete -->
					<input type="button" value="{lang删除}" onclick="post_del('{$value.id}')" class="layui-btn layui-btn-xs layui-btn-danger" />
					<!-- /if -->
				</div>
			</td>
			<!-- /if -->
		</tr>
		<!-- /loop -->
		</table>
		<!-- include tpl=usercp/pagelist -->
	</div>
</div>
<script type="text/javascript">
$(document).ready(function(){
    var total = $("#tablelist").attr("data-total");
	var psize = $("#tablelist").attr("data-psize");
	var totalRow = $("#tablelist").attr("data-totalRow");
	var ftype = $("#tablelist").attr("data-ftype");
	var opt = {'limit':psize};
	if(totalRow == 1){
		opt['totalRow'] = true;
	}
	opt['setWidth'] = function(e){
		var url = get_url('fields','width','mid='+ftype+"&width="+e.setWidth+"&field="+e.field);
		$.phpok.json(url,function(rs){
			if(rs.status){
				return true;
			}
			$.dialog.tips(rs.info);
			return false;
		})
	}
	layui.table.init("tablelist",opt);
});
</script>
<!-- include tpl=usercp/foot -->