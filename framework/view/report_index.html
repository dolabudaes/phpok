<!-- include tpl=head_lay -->
<style>
	.layui-card-header .layui-icon {
		line-height: initial;
		position: absolute;
		right: 0px;
		top: 22%;
		margin-top: -7px;
	}
</style>
<div class="layui-card">
	<div class="layui-form layui-card-header layuiadmin-card-header-auto">
		<form method="post">
		<div class="layui-form-item">
			<div class="layui-inline">
				<label class="layui-form-label">{lang项目}</label>
				<div class="layui-input-inline">
					<select name="type" lay-filter="type">
						<option value="">{lang请选择…}</option>
						<!-- loop from=$plist key=$key value=$value id=$tmpid -->
						<option value="{$key}"{if $type == $key} selected{/if}>{$value}</option>
						<!-- /loop -->
					</select>
				</div>
			</div>
			<div class="layui-inline {if !$xlist}hide{/if}" data-id="line-x">
				<label class="layui-form-label">{lang统计频次}</label>
				<div class="layui-input-inline">
					<select name="x">
						<option value="">{lang请选择…}</option>
						<!-- loop from=$xlist key=$key value=$value id=$tmpid -->
						<option value="{$key}"{if $x == $key} selected{/if}>{$value}</option>
						<!-- /loop -->
					</select>
				</div>
			</div>
			<div class="layui-inline {if !$ylist}hide{/if}" data-id="line-y">
				<label class="layui-form-label">{lang统计选项}</label>
				<div class="layui-input-inline"  style="width: auto">
					<!-- loop from=$ylist key=$key value=$value id=$tmpid -->
					<input type="checkbox" name="y[]" title="{$value}" class="layui-input" value="{$key}"{if $y && is_array($y) && in_array($key,$y) } checked{/if} />
					<!-- /loop -->
				</div>
			</div>
			<div class="layui-inline {if !$zlist}hide{/if}" data-id="line-z">
				<label class="layui-form-label" style="padding: 15px 35px 0px 15px">{lang计算方式}<i style="top: 68%;" class="layui-icon layui-icon-tips" lay-tips="{lang仅限扩展字段有效}" lay-offset="-10"></i></label>
				<div class="layui-input-inline" style="width: 160px;">
					<input type="radio" name="data_mode" title="{lang数量计算（Count）}" class="layui-input" value="count"{if !$data_mode || $data_mode == 'count'} checked{/if} />
				</div>
				<div class="layui-input-inline" style="width: 150px;">
					<input type="radio" name="data_mode" title="{lang和计算（SUM）}" class="layui-input" value="sum"{if $data_mode && $data_mode == 'sum'} checked{/if} />
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">{lang时间范围}</label>
				<div class="layui-input-inline" style="width: 140px;">
					<input type="text" name="startdate" id="startdate" class="layui-input" value="{$startdate}" placeholder="开始时间" />
				</div>
				<div class="layui-form-mid">~</div>
				<div class="layui-input-inline" style="width: 140px;">
					<input type="text" name="stopdate" id="stopdate" class="layui-input" value="{$stopdate}" placeholder="结束时间" />
				</div>
			</div>
			<div class="layui-inline">
				<label class="layui-form-label">{lang图表模式}</label>
				<div class="layui-input-inline">
					<select name="chart">
						<option value="">{lang请选择…}</option>
						<option value="line"{if $chart == 'line'} selected{/if}>{lang折线图}</option>
						<option value="bar"{if $chart == 'bar'} selected{/if}>{lang柱状图}</option>
					</select>
				</div>
			</div>
			<div class="layui-inline">
				<button type="submit" class="layui-btn layuiadmin-btn-list" lay-submit lay-filter="LAY-app-contlist-search">
					<i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>统计
				</button>
			</div>
		</div>
		</form>
	</div>
	<div class="layui-card-body">
		<table class="layui-table">
			<thead>
			<tr>
				<th>{$x_title}</th>
				<!-- loop from=$y_title key=$key value=$value id=$tmpid -->
				<th name="y_title">{$value}</th>
				<!-- /loop -->
			</tr>
			</thead>
			<tbody>
			<!-- loop from=$rslist key=$key value=$value id=$tmpid -->
			<tr name="chart">
				<td class="center">{$value.x}</td>
				<!-- loop from=$y_title key=$k value=$v id=$idx -->
				<td class="center">{$value['y_'.$k]}</td>
				<!-- /loop -->
			</tr>
			<!-- /loop -->
			</tbody>
		</table>
		<div id="chart_main" class="layui-carousel" data-anim="fade" lay-filter="LAY-index-normcol" lay-anim="fade" style="width: 100%; height: 420px;"></div>
	</div>
</div>
<!-- if $chart -->
<script type="text/javascript">
    $(document).ready(function(){
        var myChart = echarts.init(document.getElementById('chart_main'));
        var chart = "{$chart}";
        var data_x = new Array();
        var data_y = new Array();
        var y_title = new Array();
        var series_data = new Array();
        $("th[name=y_title]").each(function(i){
            y_title[i] = $(this).text();
            var tmp = {'name':y_title[i],'type':chart};
            var tmp_data = new Array();
            $("tr[name=chart]").each(function(m){
                var m_i = i+1;
                tmp_data[m] = $(this).find('td:eq('+m_i+')').text();
            });
            tmp.data = tmp_data;
            series_data[i] = tmp;
        });
        $("tr[name=chart]").each(function(i){
            data_x[i] = $(this).find('td:eq(0)').text();
        });
        var option = {
            title:{text:'{$lead_title}'},
            legend: {data:y_title},
            xAxis: {data: data_x},
            yAxis: {},
            series: series_data
        };
        myChart.setOption(option);
    });
</script>
<!-- /if -->
<!-- include tpl=foot_lay -->