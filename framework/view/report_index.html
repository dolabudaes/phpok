<!-- include tpl=head -->
<div class="tips">
	<div class="left">
		{lang报表及统计} &raquo; <!-- if $lead_title -->{$lead_title}<!-- else -->{lang选择要查看的项目}<!-- /if -->
	</div>
</div>
<div class="help" style="padding:5px;">
	<form method="post">
	<ul class="layout">
		<li>
			<select name="type" onchange="$.admin_report.select_project(this.value)">
				<option value="">{lang请选择…}</option>
				<!-- loop from=$plist key=$key value=$value id=$tmpid -->
				<option value="{$key}"{if $type == $key} selected{/if}>{$value}</option>
				<!-- /loop -->
			</select>
		</li>
		<li data-id="line-x"{if !$xlist} class="hide"{/if}>
			<select name="x">
				<option value="">{lang请选择统计频次}</option>
				<!-- loop from=$xlist key=$key value=$value id=$tmpid -->
				<option value="{$key}"{if $x == $key} selected{/if}>{$value}</option>
				<!-- /loop -->
			</select>
		</li>
		<li data-id="line-y"{if !$ylist} class="hide"{/if}>
			<ul class="layout">
				<li>{lang统计项目}</li>
				<!-- loop from=$ylist key=$key value=$value id=$tmpid -->
				<li><label><input type="checkbox" name="y[]" value="{$key}"{if $y && is_array($y) && in_array($key,$y) } checked{/if} />{$value}</label></li>
				<!-- /loop -->
			</ul>
		</li>
		<li data-id="line-z"{if !$zlist} class="hide"{/if}>
			<ul class="layout">
				<li><label><input type="radio" name="data_mode" value="count"{if !$data_mode || $data_mode == 'count'} checked{/if} />{lang数量计算（Count）}</label></li>
				<li><label><input type="radio" name="data_mode" value="sum"{if $data_mode && $data_mode == 'sum'} checked{/if} />{lang和计算（SUM）}</label></li>
			</ul>
		</li>
		<li><input type="text" name="startdate" id="startdate" class="w150" value="{$startdate}" placeholder="{lang开始时间}" /></li>
		<li><input type="text" name="stopdate" id="stopdate" class="w150" value="{$stopdate}" placeholder="{lang结束时间}" /></li>
		<li>
			<select name="chart">
				<option value="">{lang请选择图表模式}</option>
				<option value="line"{if $chart == 'line'} selected{/if}>{lang折线图}</option>
				<option value="bar"{if $chart == 'bar'} selected{/if}>{lang柱状图}</option>
			</select>
		</li>
		<li><input type="submit" value="{lang提交}" class="phpok-btn" /></li>
		<li></li>
	</ul>
	</form>
</div>
<div class="report">
	<!-- if $rslist -->
	<div class="list">
	<table width="100%" class="list" cellpadding="0" cellspacing="0">
	<tr>
		<th>{$x_title}</th>
		<!-- loop from=$y_title key=$key value=$value id=$tmpid -->
		<th name="y_title">{$value}</th>
		<!-- /loop -->
	</tr>
	<!-- loop from=$rslist key=$key value=$value id=$tmpid -->
	<tr name="chart">
		<td class="center">{$value.x}</td>
		<!-- loop from=$y_title key=$k value=$v id=$idx -->
		<td class="center">{$value['y_'.$k]}</td>
		<!-- /loop -->
	</tr>
	<!-- /loop -->
	</table>
	</div>
	<!-- /if -->
	<!-- if $chart -->
	<div id="chart_main" style="width:100%;height:600px;margin-top:10px;"></div>
	<!-- /if -->
</div>

<!-- if $chart -->
<script type="text/javascript">
$(document).ready(function(){
    var myChart = echarts.init(document.getElementById('chart_main'));
	var chart = "{$chart}";
    var data_x = new Array();
    var data_y = new Array();
    var y_title = new Array();
    var series_data = new Array();
    $("th[name=y_title]").each(function(i){
	    y_title[i] = $(this).text();
	    var tmp = {'name':y_title[i],'type':chart};
	    var tmp_data = new Array();
	    $("tr[name=chart]").each(function(m){
		    var m_i = i+1;
		    tmp_data[m] = $(this).find('td:eq('+m_i+')').text();
	    });
	    tmp.data = tmp_data;
	    series_data[i] = tmp;
    });
    $("tr[name=chart]").each(function(i){
	    data_x[i] = $(this).find('td:eq(0)').text();
    });
    var option = {
	    title:{text:'{$lead_title}'},
        legend: {data:y_title},
        xAxis: {data: data_x},
        yAxis: {},
        series: series_data
    };
    myChart.setOption(option);
});
</script>
<!-- /if -->
</div>

<!-- include tpl=foot -->